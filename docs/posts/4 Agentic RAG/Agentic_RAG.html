<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Aneesh Sathe">
<meta name="dcterms.date" content="2024-04-30">

<title>Agentic RAG – studio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-d1b12f2568ecbe55642fee6aa00bd082.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-b2511bcbb01c2159fd96a78deb42ffd9.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">studio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://aneeshsathe.com"> <i class="bi bi-wordpress" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/aneeshsathe"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/aneeshsathe"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Agentic RAG</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">AI-agents</div>
                <div class="quarto-category">AI</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Aneesh Sathe </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 30, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="helping-ai-agents-answer-questions-in-your-narrow-domain" class="level1">
<h1>Helping AI agents answer questions in your narrow domain</h1>
<p><span style="font-size:2em;"><strong>Table of Contents</strong></span> 1. <a href="#1-import-libraries-and-setup-api-endpoint">Setup: Import Libraries and API endpoint</a> 2. <a href="#2-create-list-of-documents-to-be-used-by-the-ai-agents">Load path to documents</a> 3. <a href="#3-construct-agents-to-use-the-documents">Create agents</a> 4. <a href="#4-ask-question-to-the-agent-about-the-new-fda-ruling-and-its-effect-on-a-hypothetical-startup">Ask AI question based on updated info</a> 5. <a href="#5-ai-output-in-easy-to-read-format">AI Output to question about LDT ruling</a></p>
<section id="import-libraries-and-setup-api-endpoint" class="level2">
<h2 class="anchored" data-anchor-id="import-libraries-and-setup-api-endpoint">1. Import libraries and setup API Endpoint</h2>
<p><a href="#helping-ai-agents-answer-questions-in-your-narrow-domain">back to top</a></p>
<div id="cell-4" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> chromadb</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> autogen</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogen.agentchat.contrib.retrieve_assistant_agent <span class="im">import</span> RetrieveAssistantAgent</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogen.agentchat.contrib.retrieve_user_proxy_agent <span class="im">import</span> RetrieveUserProxyAgent</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogen <span class="im">import</span> config_list_from_json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-5" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A local work_dir in case you want to execute code and store local files</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>work_dir <span class="op">=</span> <span class="st">"work_dir"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>docs_dir <span class="op">=</span> <span class="st">"rag_docs/"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>docs_path <span class="op">=</span> Path(work_dir, docs_dir)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>config_list_path <span class="op">=</span> <span class="st">"../json_configs/OAI_CONFIG_LIST.json"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>config_list <span class="op">=</span> config_list_from_json(env_or_file<span class="op">=</span>config_list_path)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>llm_config <span class="op">=</span> {<span class="st">"config_list"</span>: config_list, <span class="st">"cache_seed"</span>: <span class="va">None</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-list-of-documents-to-be-used-by-the-ai-agents" class="level2">
<h2 class="anchored" data-anchor-id="create-list-of-documents-to-be-used-by-the-ai-agents">2. Create list of documents to be used by the AI agents</h2>
<p><a href="#helping-ai-agents-answer-questions-in-your-narrow-domain">back to top</a></p>
<div id="cell-7" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># more URLS or pdfs can be added here as needed</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>docs_list <span class="op">=</span> [ </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">"https://www.fda.gov/news-events/press-announcements/fda-takes-action-aimed-helping-ensure-safety-and-effectiveness-laboratory-developed-tests"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="construct-agents-to-use-the-documents" class="level2">
<h2 class="anchored" data-anchor-id="construct-agents-to-use-the-documents">3. Construct agents to use the documents</h2>
<p><a href="#helping-ai-agents-answer-questions-in-your-narrow-domain">back to top</a></p>
<div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. create an RetrieveAssistantAgent instance named "assistant"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>assistant <span class="op">=</span> RetrieveAssistantAgent(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"assistant"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    system_message<span class="op">=</span><span class="st">"You are a helpful assistant."</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    llm_config<span class="op">=</span>{</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeout"</span>: <span class="dv">600</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cache_seed"</span>: <span class="dv">42</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"config_list"</span>: config_list,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. create the RetrieveUserProxyAgent instance named "ragproxyagent"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>ragproxyagent <span class="op">=</span> RetrieveUserProxyAgent(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">"ragproxyagent"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    human_input_mode<span class="op">=</span><span class="st">"NEVER"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    max_consecutive_auto_reply<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    retrieve_config<span class="op">=</span>{</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"task"</span>: <span class="st">"code"</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"docs_path"</span>: docs_list,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"chunk_token_size"</span>: <span class="dv">2000</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"model"</span>: config_list[<span class="dv">0</span>][<span class="st">"model"</span>],</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"vector_db"</span>: <span class="st">"chroma"</span>,  </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">"overwrite"</span>: <span class="va">True</span>,  <span class="co"># set to True if you want to overwrite an existing collection</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    code_execution_config<span class="op">=</span><span class="va">False</span>,  <span class="co"># set to False if you don't want to execute the code</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ask-question-to-the-agent-about-the-new-fda-ruling-and-its-effect-on-a-hypothetical-startup" class="level2">
<h2 class="anchored" data-anchor-id="ask-question-to-the-agent-about-the-new-fda-ruling-and-its-effect-on-a-hypothetical-startup">4. Ask Question to the agent about the new FDA ruling and it’s effect on a hypothetical startup</h2>
<p><a href="#helping-ai-agents-answer-questions-in-your-narrow-domain">back to top</a></p>
<div id="cell-11" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset the assistant. Always reset the assistant before starting a new conversation.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>assistant.reset()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>code_problem <span class="op">=</span> <span class="st">"I am a AI for healthcare product startup and have active LDTS. How does the new FDA ruling affect LDTs and the startup?"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>chat_result <span class="op">=</span> ragproxyagent.initiate_chat(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    assistant, message<span class="op">=</span>ragproxyagent.message_generator, problem<span class="op">=</span>code_problem</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of requested results 20 is greater than number of elements in index 1, updating n_results = 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>VectorDB returns doc_ids:  [['216d280b']]
Adding content of doc 216d280b to context.
ragproxyagent (to assistant):

You're a retrieve augmented coding assistant. You answer user's questions based on your own knowledge and the
context provided by the user.
If you can't answer the question with or without the current context, you should reply exactly `UPDATE CONTEXT`.
For code generation, you must obey the following rules:
Rule 1. You MUST NOT install any packages because all the packages needed are already installed.
Rule 2. You must follow the formats below to write your code:
```language
# your code
```

User's question is: I am a AI for healthcare product startup and have active LDTS. How does the new FDA ruling affect LDTs and the startup?

Context is: # FDA Takes Action Aimed at Helping to Ensure the Safety and Effectiveness of Laboratory Developed Tests | FDA

FDA Takes Action Aimed at Helping to Ensure the Safety and Effectiveness of Laboratory Developed Tests | FDA

* [Skip to main content](#main-content)
* [Skip to FDA Search](#search-form)
* [Skip to in this section menu](#section-nav)
* [Skip to footer links](#footer-heading)

 

 

![U.S. flag](/themes/custom/preview/assets/images/US_Flag.png)
An official website of the United States government
Here’s how you know

![Dot gov](/themes/custom/preview/assets/images/icon-dot-gov.svg)

**The .gov means it’s official.**  
Federal government websites often end in .gov or .mil. Before sharing sensitive information, make sure you're on a federal government site.

![SSL](/themes/custom/preview/assets/images/icon-https.svg)

**The site is secure.**  
 The **https://** ensures that you are connecting to the official website and that any information you provide is encrypted and transmitted securely.

[U.S. Food and Drug Administration
=================================](/ "FDA Homepage")

* Search
* [Menu](#primary-nav)

Search FDA

Submit search

 

Featured
--------

* [Report a Product Problem](https://www.safetyreporting.hhs.gov/smarthub#/ "Report a Problem with an FDA Regulated Product")
* [Contact FDA](/about-fda/contact-fda)
* [FDA Guidance Documents](/regulatory-information/search-fda-guidance-documents)
* [Recalls, Market Withdrawals and Safety Alerts](/safety/recalls-market-withdrawals-safety-alerts)
* [Press Announcements](/news-events/newsroom/press-announcements)
* [Warning Letters](/inspections-compliance-enforcement-and-criminal-investigations/compliance-actions-and-activities/warning-letters)
* [Advisory Committees](/advisory-committees)
* [En Español](/about-fda/en-espanol)

Products
--------

* [Food](/food)
* [Drugs](/drugs)
* [Medical Devices](/medical-devices)
* [Radiation-Emitting Products](/radiation-emitting-products)
* [Vaccines, Blood, and Biologics](/vaccines-blood-biologics)
* [Animal and Veterinary](/animal-veterinary)
* [Cosmetics](/cosmetics)
* [Tobacco Products](/tobacco-products)

Topics
------

* [About FDA](/about-fda)
* [Combination Products](/combination-products)
* [Regulatory Information](/regulatory-information)
* [Safety](/safety)
* [Emergency Preparedness](/emergency-preparedness-and-response)
* [International Programs](/international-programs)
* [News and Events](/news-events)
* [Training and Continuing Education](/training-and-continuing-education)
* [Inspections and Compliance](/inspections-compliance-enforcement-and-criminal-investigations)
* [Science and Research](/science-research)

Information For
---------------

* [Consumers](/consumers)
* [Patients](/patients)
* [Industry](/industry)
* [Health Professionals](/health-professionals)
* [Federal, State and Local Officials](/federal-state-local-tribal-and-territorial-officials)

[In this section:

 Press Announcements](#section-nav)

* [Press Announcements](/news-events/fda-newsroom/press-announcements "Press Announcements")

1. [Home](/)
2. [News &amp; Events](/news-events)
3. [FDA Newsroom](/news-events/fda-newsroom)
4. [Press Announcements](/news-events/fda-newsroom/press-announcements)
5. FDA Takes Action Aimed at Helping to Ensure the Safety and Effectiveness of Laboratory Developed Tests

1. [Press Announcements](/news-events/fda-newsroom/press-announcements "Press Announcements")

FDA News Release

FDA Takes Action Aimed at Helping to Ensure the Safety and Effectiveness of Laboratory Developed Tests
======================================================================================================

* [Share](https://www.facebook.com/sharer/sharer.php?u=https://www.fda.gov%2Fnews-events%2Fpress-announcements%2Ffda-takes-action-aimed-helping-ensure-safety-and-effectiveness-laboratory-developed-tests)
* [Post](https://x.com/intent/tweet/?text=FDA%20Takes%20Action%20Aimed%20at%20Helping%20to%20Ensure%20the%20Safety%20and%20Effectiveness%20of%20Laboratory%20Developed%20Tests&amp;url=https://www.fda.gov%2Fnews-events%2Fpress-announcements%2Ffda-takes-action-aimed-helping-ensure-safety-and-effectiveness-laboratory-developed-tests)
* [Linkedin](https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.fda.gov%2Fnews-events%2Fpress-announcements%2Ffda-takes-action-aimed-helping-ensure-safety-and-effectiveness-laboratory-developed-tests&amp;title=FDA%20Takes%20Action%20Aimed%20at%20Helping%20to%20Ensure%20the%20Safety%20and%20Effectiveness%20of%20Laboratory%20Developed%20Tests&amp;source=FDA)
* [Email](mailto:?subject=FDA%20Takes%20Action%20Aimed%20at%20Helping%20to%20Ensure%20the%20Safety%20and%20Effectiveness%20of%20Laboratory%20Developed%20Tests&amp;body=https://www.fda.gov%2Fnews-events%2Fpress-announcements%2Ffda-takes-action-aimed-helping-ensure-safety-and-effectiveness-laboratory-developed-tests)
* [Print](javascript:window.print(); "Print this page")

For Immediate Release:
April 29, 2024

[Español](https://www.fda.gov/news-events/press-announcements/la-fda-toma-medidas-destinadas-garantizar-la-inocuidad-y-eficacia-de-las-pruebas-efectuadas-en)

Today, the U.S. Food and Drug Administration took action aimed at helping to ensure the safety and effectiveness of laboratory developed tests, or LDTs, which are used in a growing number of health care decisions and about which concerns have been raised for many years.&nbsp;

LDTs are in vitro diagnostic products (IVDs) that the FDA has described as intended for clinical use and designed, manufactured and used within a single clinical laboratory that meets certain regulatory requirements. IVDs can play an important role in health care; they are used in the collection, preparation and examination of specimens taken from the human body, such as blood, saliva or tissue. They can be used to measure or detect substances or analytes, such as proteins, glucose, cholesterol or DNA, to provide information about a patient’s health, including to identify, monitor or determine treatment for diseases and conditions.&nbsp;

The FDA announced a final rule today amending the FDA’s regulations to make explicit that IVDs are devices under the Federal Food, Drug, and Cosmetic Act (FD&amp;C Act) including when the manufacturer of the IVD is a laboratory. Along with this amendment, the FDA issued a policy to phase out, over the course of four years, its general enforcement discretion approach for LDTs. The agency also issued targeted enforcement discretion policies for certain categories of IVDs manufactured by laboratories.

**“LDTs are being used more widely than ever before – for use in newborn screening, to help predict a person’s risk of cancer, or aid in diagnosing heart disease and Alzheimer’s. The agency cannot stand by while Americans continue to rely on results of these tests without assurance that they work,” said FDA Commissioner Robert M. Califf, M.D. “The final rule announced today aims to provide crucial oversight of these tests to help ensure that important health care decisions are made based on test results that patients and health care providers can trust.”**

Although historically the FDA has generally exercised enforcement discretion for most LDTs, meaning that the agency generally has not enforced applicable requirements with respect to most LDTs, the risks associated with most modern LDTs are much greater than the risks associated with LDTs used when the FDA’s enforcement discretion approach was adopted many decades ago. At that time, many LDTs were lower risk, small volume and used for specialized needs of a local patient population. Now, many LDTs are used more widely, for a larger and more diverse population, with large laboratories accepting specimens from across the country. LDTs also increasingly rely on high-tech instrumentation and software, are performed in large volumes and are used more frequently to help guide critical health care decisions.

Moreover, there is a growing body of evidence that demonstrates that some IVDs offered as LDTs raise public health concerns; for example, they do not provide accurate test results or do not perform as well as FDA-authorized tests, including from published studies in the scientific literature, the FDA’s own experience in reviewing IVDs offered as LDTs, news articles and class-action lawsuits.

The FDA is aware of numerous examples of potentially inaccurate, unsafe, ineffective or poor quality IVDs offered as LDTs that caused or may have caused patient harm, including tests used to select cancer treatment, aid in the diagnosis of COVID-19, aid in the management of patients with rare diseases and identify a patient’s risk of cancer.&nbsp;

Without greater oversight of the safety and effectiveness of LDTs, patients may be more likely to initiate unnecessary treatment, or delay or forego proper treatment based on inaccurate test results or tests promoted with false or misleading claims. This could result in harm, including worsening illness or death, as well as unnecessarily increase health care costs.&nbsp;

Increased compliance with device requirements under the FD&amp;C Act (such as premarket review, quality system (QS) requirements, adverse event reporting, establishment registration and device listing, labeling requirements and investigational use requirements) will put patients and health care providers in a better position to have confidence in IVDs regardless of where they are manufactured.&nbsp;

With increased oversight, the FDA will also be able to help promote adequate representation in validation studies, as well as transparency regarding potential differential performance and unknown performance in certain patient populations, which may ultimately help advance health equity.

**“Today’s action is a critical step toward helping to ensure the safety and effectiveness of LDTs, while also taking into account other public health considerations, including continued access to critical tests patients rely upon,” said Jeff Shuren, M.D., J.D., director of the FDA’s Center for Devices and Radiological Health. “Through targeted enforcement discretion policies for certain categories of tests manufactured by a laboratory, we expect patients and health care professionals will continue to have access to the tests they need while having greater confidence that the tests they rely on are accurate.”**

The phaseout of the FDA’s general enforcement discretion approach for LDTs over a period of four years will protect the public health by helping to assure the safety and effectiveness of these tests, while avoiding undue disruption to patient care. Better assuring the safety and effectiveness of LDTs may also foster test innovation and facilitate the collective efforts of the scientific and medical communities to identify promising technologies, new therapies or areas worthy of future research.

Importantly, the FDA considered the large volume of comments received on the notice of proposed rulemaking, and in light of that input, has adjusted the phaseout policy in a manner that better serves the public health. After this phaseout, the FDA generally will expect IVDs made by either a non-laboratory or laboratory to meet the same requirements, though certain IVDs manufactured by laboratories may fall within one of the agency’s targeted enforcement discretion policies.&nbsp;

The FDA intends to exercise enforcement discretion with regard to premarket review and most quality system requirements for certain categories of IVDs, including but not limited to:

* Currently marketed IVDs offered as LDTs that were first marketed prior to the date of issuance of the final rule. This enforcement discretion policy is intended to address the risk that the perceived costs of compliance with such requirements could lead to the widespread loss of access to beneficial IVDs on which patients currently rely.
* LDTs manufactured and performed by a laboratory integrated within a health care system to meet an unmet need of patients receiving care within the same health care system when an FDA-authorized test is not available. This enforcement discretion policy is intended to help avoid patients being deprived of critically needed LDTs where certain risk mitigations exist that may help laboratories to identify any problems with their LDT and may help inform appropriate use and interpretation of such LDTs.

The FDA has also included additional enforcement discretion policies, such as for LDTs approved by the New York State’s Clinical Laboratory Evaluation Program (CLEP), as described in the preamble to the final rule, where that program’s review of analytical and clinical validity helps to mitigate the risk of harm from inaccurate and unreliable LDTs.&nbsp;

### Draft Guidance Documents

The agency also issued two draft guidances today. One [provides the agency’s thinking](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/enforcement-policy-certain-in-vitro-diagnostic-devices-immediate-public-health-response-absence) about an enforcement discretion policy for certain laboratories offering certain unauthorized IVDs for immediate response to an emergent situation, such as an outbreak of an infectious disease, in the absence of a declaration applicable to IVDs under section 564 of the FD&amp;C Act. The other [provides insight](https://www.fda.gov/regulatory-information/search-fda-guidance-documents/consideration-enforcement-policies-tests-during-section-564-declared-emergency) into the FDA’s thinking about the factors the agency intends to consider when developing a policy regarding enforcement discretion for certain IVDs during a public health emergency declared under section 564 of the FD&amp;C Act.

Related Information
-------------------

Related Information
* [Federal Register, Final Rule](https://www.federalregister.gov/public-inspection/2024-08935/medical-devices-laboratory-developed-tests)
* [FDA: Laboratory Developed Tests](https://www.fda.gov/medical-devices/in-vitro-diagnostics/laboratory-developed-tests)
* [FDA: LDT Frequently Asked Questions](https://www.fda.gov/medical-devices/laboratory-developed-tests/laboratory-developed-tests-frequently-asked-questions)

###

Boilerplate
The FDA, an agency within the U.S. Department of Health and Human Services, protects the public health by assuring the safety, effectiveness, and security of human and veterinary drugs, vaccines and other biological products for human use, and medical devices. The agency also is responsible for the safety and security of our nation’s food supply, cosmetics, dietary supplements, radiation-emitting electronic products, and for regulating tobacco products.

---

Inquiries
---------

Media:

 [James (Jim) McKinney](mailto:james.mckinney@fda.hhs.gov)

 240-328-7305
 

Consumer:
 888-INFO-FDA

  

&nbsp;

* Content current as of:
----------------------

04/29/2024
* Regulated Product(s)
--------------------

    + Medical Devices
* Follow FDA
----------

    + [Follow @US\_FDA on X](https://x.com/US_FDA)
    + [Follow FDA on Facebook](https://www.facebook.com/FDA)
    + [Follow @FDAMedia on X](https://x.com/FDAMedia)

 

 [More Press Announcements](/news-events/newsroom/press-announcements)

* 

 

Footer Links
------------

* [FDA Archive](/about-fda/about-website/fdagov-archive)
* [About FDA](/about-fda)
* [Accessibility](/about-fda/about-website/internet-accessibility)

* [Visitor Information](/about-fda/visitor-information)
* [Website Policies / Privacy](/about-fda/about-website/website-policies)
* [No FEAR Act](/about-fda/jobs-and-training-fda/no-fear-act)
* [Vulnerability Disclosure Policy](https://www.hhs.gov/vulnerability-disclosure-policy/index.html)

* [FOIA](/regulatory-information/freedom-information "Freedom of Information Act")
* [HHS.gov](https://www.hhs.gov/ "Health and Human Services")
* [USA.gov](https://www.usa.gov/)

[Contact FDA](/about-fda/contact-fda)
[Follow FDA on Facebook](https://www.facebook.com/FDA "Follow FDA on Facebook")
[Follow FDA on X](https://x.com/US_FDA "Follow FDA on X")
[Follow FDA on Instagram](https://instagram.com/FDA "Follow FDA on Instagram")
  

[FDA Homepage](/ "FDA Homepage")

 
Contact Number
 1-888-INFO-FDA (1-888-463-6332)
 

Back to Top



--------------------------------------------------------------------------------
assistant (to ragproxyagent):

The new FDA ruling significantly affects Laboratory Developed Tests (LDTs) and startups operating within this domain. Here’s how:

1. **Increased Oversight**: The FDA has amended its regulations to clearly classify IVDs (In Vitro Diagnostics), including those manufactured within laboratories as LDTs, as medical devices under the Federal Food, Drug, and Cosmetic Act (FD&amp;C Act). This creates a regulatory landscape where previously unenforced standards will now be actively governed.

2. **Phase-Out of Enforcement Discretion**: Historically, the FDA exercised enforcement discretion for most LDTs, not stringently enforcing certain regulatory requirements. This approach is changing. The new regulation introduces a four-year phase-out of this general enforcement discretion, moving towards strict adherence to device requirements such as premarket reviews, quality system requirements, and adverse event reporting.

3. **Targeted Enforcement Discretion Policies**: Despite the phase-out, the FDA aims to implement targeted enforcement discretion for certain categories of LDTs. This includes:
   - Currently marketed IVDs offered as LDTs prior to the new rule’s issuance.
   - LDTs produced by laboratories integrated within a healthcare system to meet specific unmet patient needs, provided no FDA-authorized test is available.

4. **Impact on Startup Operations**: Startups in the healthcare product domain will need to adjust their operations and development strategies to comply with the new regulatory requirements. This includes ensuring that new and existing tests meet the stricter regulations set by the FDA, which could involve significant investment in clinical validation and quality control.

5. **Opportunity for Innovation and Trust**: Stringent regulations can foster innovation, leading to the development of more reliable and effective tests. Also, with increased regulatory oversight, healthcare providers and patients may have greater confidence in the safety and efficacy of LDTs, potentially leading to greater market acceptance.

6. **Need for Strategic Adjustments**: Startups may need to reallocate resources to deal with these regulatory changes, including hiring regulatory affairs specialists, investing in additional clinical studies, and adapting marketing strategies.

7. **Enforcement Policies during Emergencies**: The FDA provided insights into enforcement discretion policies that might apply during public emergencies (like infectious disease outbreaks), which might be relevant for startups focusing on rapid test development for such situations.

Understanding and adapting to these changes is crucial for startups in the LDT space to ensure compliance and to leverage potential opportunities for innovation and market leadership under the new regulatory framework.

--------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="ai-output-in-easy-to-read-format" class="level2">
<h2 class="anchored" data-anchor-id="ai-output-in-easy-to-read-format">5. AI output in easy to read format:</h2>
<p><a href="#helping-ai-agents-answer-questions-in-your-narrow-domain">back to top</a></p>
<p>The new FDA ruling significantly affects Laboratory Developed Tests (LDTs) and startups operating within this domain. Here’s how:</p>
<ol type="1">
<li><p><strong>Increased Oversight</strong>: The FDA has amended its regulations to clearly classify IVDs (In Vitro Diagnostics), including those manufactured within laboratories as LDTs, as medical devices under the Federal Food, Drug, and Cosmetic Act (FD&amp;C Act). This creates a regulatory landscape where previously unenforced standards will now be actively governed.</p></li>
<li><p><strong>Phase-Out of Enforcement Discretion</strong>: Historically, the FDA exercised enforcement discretion for most LDTs, not stringently enforcing certain regulatory requirements. This approach is changing. The new regulation introduces a four-year phase-out of this general enforcement discretion, moving towards strict adherence to device requirements such as premarket reviews, quality system requirements, and adverse event reporting.</p></li>
<li><p><strong>Targeted Enforcement Discretion Policies</strong>: Despite the phase-out, the FDA aims to implement targeted enforcement discretion for certain categories of LDTs. This includes:</p>
<ul>
<li>Currently marketed IVDs offered as LDTs prior to the new rule’s issuance.</li>
<li>LDTs produced by laboratories integrated within a healthcare system to meet specific unmet patient needs, provided no FDA-authorized test is available.</li>
</ul></li>
<li><p><strong>Impact on Startup Operations</strong>: Startups in the healthcare product domain will need to adjust their operations and development strategies to comply with the new regulatory requirements. This includes ensuring that new and existing tests meet the stricter regulations set by the FDA, which could involve significant investment in clinical validation and quality control.</p></li>
<li><p><strong>Opportunity for Innovation and Trust</strong>: Stringent regulations can foster innovation, leading to the development of more reliable and effective tests. Also, with increased regulatory oversight, healthcare providers and patients may have greater confidence in the safety and efficacy of LDTs, potentially leading to greater market acceptance.</p></li>
<li><p><strong>Need for Strategic Adjustments</strong>: Startups may need to reallocate resources to deal with these regulatory changes, including hiring regulatory affairs specialists, investing in additional clinical studies, and adapting marketing strategies.</p></li>
<li><p><strong>Enforcement Policies during Emergencies</strong>: The FDA provided insights into enforcement discretion policies that might apply during public emergencies (like infectious disease outbreaks), which might be relevant for startups focusing on rapid test development for such situations.</p></li>
</ol>
<p>Understanding and adapting to these changes is crucial for startups in the LDT space to ensure compliance and to leverage potential opportunities for innovation and market leadership under the new regulatory framework.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>